<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Summary</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(to right, #ffecd2, #fcb69f);
    margin: 0;
    padding: 0;
    text-align: center;
  }
  .order-box {
    background: #fff;
    margin: 40px auto;
    padding: 30px;
    width: 500px;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  }
  h1 { color: #e74c3c; }
  .timer {
    font-size: 1.5em;
    font-weight: bold;
    color: #27ae60;
    margin: 20px 0;
  }
  .order-btn {
    display: inline-block;
    padding: 12px 24px;
    background: #27ae60;
    color: #fff;
    font-weight: bold;
    border-radius: 8px;
    text-decoration: none;
    margin-top: 20px;
    cursor: pointer;
  }
  .order-btn:hover { background: #219150; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  table, th, td {
    border: 1px solid #ddd;
  }
  th, td {
    padding: 10px;
  }
  input[type="number"] {
    width: 60px;
    text-align: center;
  }
</style>
</head>
<body>

<div class="order-box">
  <h1>üßæ Order Summary</h1>
  <div class="timer">‚è≥ Time Left: <span id="countdown">02:00</span></div>
  
  <table id="orderTable">
    <thead>
      <tr>
        <th>Dish</th>
        <th>Qty</th>
        <th>Price</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <h2>Total: ‚Çπ<span id="totalAmount">0</span></h2>

  <button id="updateOrderBtn" class="order-btn">Update Order</button>
  <a href="payment.html" class="order-btn" id="confirmBtn">Confirm Now</a>
</div>

<script>
const prices = {
  "Idli": 20, "Dosa": 40, "Poori_with_Bhaji": 50, "Upma": 35, "Pongal": 45, "Vegetable_Sandwich": 40,
  "Veg_Biryani": 120, "Paneer_Butter_Masala": 150, "Dal_Tadka": 90, "Aloo_Gobi": 100, "Veg_Thali": 180, "Chole_Bhature": 120,
  "Samosa": 20, "Paneer_Pakora": 25, "Veg_Sandwich": 40, "Cutlet": 30, "Bhel_Puri": 35, "Pani_Puri": 30,
  "Buttermilk": 25, "Lassi": 40, "Masala_Chai": 20, "Lemon_Tea": 25, "Green_Tea": 30, "Cold_Coffee": 50,
  "Orange_Juice": 30, "Apple_Juice": 30, "Pineapple_Juice": 35, "Watermelon_Juice": 30, "Mosambi_Juice": 30, "Mango_Juice": 35,
  "Ice_Cream": 60, "Brownie": 70, "Gulab_Jamun": 50, "Rasgulla": 45, "Kaju_Katli": 80, "Carrot_Halwa": 90
};

const params = new URLSearchParams(window.location.search);
let tbody = document.querySelector("#orderTable tbody");
let totalEl = document.getElementById("totalAmount");

// render initial table
function renderOrder() {
  tbody.innerHTML = "";
  let total = 0;
  for (let [dish, qty] of params.entries()) {
    qty = parseInt(qty);
    if (qty > 0 && prices[dish]) {
      let displayName = dish.replace(/_/g, " ");
      let row = document.createElement("tr");
      row.innerHTML = `
        <td>${displayName}</td>
        <td><input type="number" min="0" value="${qty}" data-dish="${dish}"></td>
        <td class="price">‚Çπ${prices[dish] * qty}</td>
      `;
      tbody.appendChild(row);
      total += prices[dish] * qty;
    }
  }
  totalEl.textContent = total;
}

renderOrder();

// update order
document.getElementById("updateOrderBtn").addEventListener("click", () => {
  let inputs = tbody.querySelectorAll("input");
  let newTotal = 0;
  inputs.forEach(inp => {
    let dish = inp.dataset.dish;
    let qty = parseInt(inp.value);
    if (qty > 0) {
      inp.closest("tr").querySelector(".price").textContent = `‚Çπ${prices[dish] * qty}`;
      newTotal += prices[dish] * qty;
      params.set(dish, qty);
    } else {
      inp.closest("tr").remove();
      params.delete(dish);
    }
  });
  totalEl.textContent = newTotal;
});

// countdown timer
let time = 120; // 2 minutes
let countdownEl = document.getElementById("countdown");
let timer = setInterval(() => {
  let minutes = Math.floor(time / 60);
  let seconds = time % 60;
  countdownEl.textContent = `${minutes.toString().padStart(2,"0")}:${seconds.toString().padStart(2,"0")}`;
  time--;

  if (time < 0) {
    clearInterval(timer);
    document.querySelectorAll("input, #updateOrderBtn").forEach(el => el.disabled = true);
    alert("‚úÖ Order Confirmed! Redirecting to payment...");
    window.location.href = "payment.html";
  }
}, 1000);
</script>

</body>
</html>
